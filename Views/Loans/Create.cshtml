@model LibrarySystem.Models.Loan

<div class="container mt-5">
    <h2 class="text-success">ğŸ“– Kitap Ã–dÃ¼nÃ§ Ver</h2>
    <hr />
    <div class="row">
        <div class="col-md-6">
            <form asp-action="Create">
                
                <div asp-validation-summary="All" class="text-danger"></div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Ãœye SeÃ§in</label>
                    
                    <select id="userSelect" name="UserId" class="form-select" onchange="sureyiGuncelle()" required>
                        <option value="" selected disabled>-- Ãœye SeÃ§iniz --</option>
                        
                        @if (ViewBag.MembersList != null)
                        {
                            foreach (var user in ViewBag.MembersList as List<LibrarySystem.Models.User>)
                            {
                                <option value="@user.UserId" data-role="@user.Role">
                                    @user.FirstName @user.LastName (@user.Username)
                                </option>
                            }
                        }
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Kitap SeÃ§in</label>
                    <select asp-for="BookId" class="form-select" asp-items="ViewBag.BookId" required>
                         <option value="">-- Kitap SeÃ§iniz --</option>
                    </select>
                    <small class="text-muted">* Sadece stoÄŸu olan kitaplar listelenir.</small>
                </div>

                <div class="alert alert-info mt-4">
                    <i class="bi bi-info-circle-fill"></i> 
                    Kitap bugÃ¼n verilecek ve seÃ§ilen Ã¼yeye otomatik olarak 
                    <strong id="gunSayisi" style="font-size: 1.3em; text-decoration: underline;">15</strong> 
                    gÃ¼n sÃ¼re tanÄ±mlanacaktÄ±r.
                </div>

                <button type="submit" class="btn btn-success">Ã–dÃ¼nÃ§ Ver</button>
                <a asp-action="Index" class="btn btn-secondary">Listeye DÃ¶n</a>
            </form>
        </div>
    </div>
</div>

<script>
    function sureyiGuncelle() {
        // 1. SeÃ§im kutusunu bul
        var selectKutusu = document.getElementById("userSelect");
        
        // 2. O an seÃ§ili olan satÄ±rÄ± (option) yakala
        var secilenOption = selectKutusu.options[selectKutusu.selectedIndex];
        
        // 3. Ä°Ã§ine gizlediÄŸimiz 'data-role' bilgisini oku
        var kullaniciRolu = secilenOption.getAttribute("data-role");
        
        // 4. VarsayÄ±lan sÃ¼re 15 gÃ¼n
        var sure = "15";

        // 5. EÄŸer rol Akademisyen veya YÃ¶netici ise sÃ¼reyi 30 yap
        // (VeritabanÄ±nda rolÃ¼n nasÄ±l yazÄ±ldÄ±ÄŸÄ±nÄ± bilmediÄŸimiz iÃ§in tÃ¼m ihtimalleri kontrol ediyoruz)
        if (kullaniciRolu === "Academic" || kullaniciRolu === "Akademisyen" || kullaniciRolu === "admin" || kullaniciRolu === "YÃ¶netici") {
            sure = "30";
        }

        // 6. Ekrandaki yazÄ±yÄ± gÃ¼ncelle
        var yaziAlani = document.getElementById("gunSayisi");
        yaziAlani.innerText = sure;

        // 7. EÄŸer 30 gÃ¼n ise dikkat Ã§ekmesi iÃ§in rengini koyu pembe yap
        if (sure === "30") {
            yaziAlani.style.color = "#d63384"; 
        } else {
            yaziAlani.style.color = "black";
        }
    }
</script>